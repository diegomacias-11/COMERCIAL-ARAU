{% extends "lista.html" %}

{% block title %}Citas{% endblock %}

{% block extra_head %}
  <style>
    .table-container { overflow-x: auto !important; }
    .table { min-width: 1400px; }
    /* sticky desactivado */
  </style>
{% endblock %}

{% block filtros %}
  <form method="get" class="filter-form-simple">
    <div class="filter-block">
      <label for="fecha_desde">Fecha desde</label>
      <input type="date" id="fecha_desde" name="fecha_desde" value="{{ fecha_desde }}" />
    </div>
    <span class="filter-separator"></span>
    <div class="filter-block">
      <label for="fecha_hasta">Fecha hasta</label>
      <input type="date" id="fecha_hasta" name="fecha_hasta" value="{{ fecha_hasta }}" />
    </div>
    <span class="filter-separator"></span>
    <div class="filter-block">
      <label for="prospecto">Prospecto</label>
      <input type="text" id="prospecto" name="prospecto" value="{{ prospecto }}" placeholder="Buscar prospecto" />
    </div>
    <span class="filter-separator"></span>
    <div class="filter-block">
      <label for="servicio">Servicio</label>
      <select id="servicio" name="servicio">
        <option value="">Todos</option>
        {% for val,label in servicio_choices %}
          <option value="{{ val }}" {% if servicio == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <span class="filter-separator"></span>
    <div class="filter-block">
      <label for="estatus_cita">Estatus cita</label>
      <select id="estatus_cita" name="estatus_cita">
        <option value="">Todos</option>
        {% for val,label in estatus_cita_choices %}
          <option value="{{ val }}" {% if estatus_cita == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <span class="filter-separator"></span>
    <div class="filter-block">
      <label for="estatus_seguimiento">Estatus seguimiento</label>
      <select id="estatus_seguimiento" name="estatus_seguimiento">
        <option value="">Todos</option>
        {% for val,label in estatus_seguimiento_choices %}
          <option value="{{ val }}" {% if estatus_seguimiento == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="filter-actions">
      <button type="submit" class="btn-filter">Filtrar</button>
      <a href="{% url 'comercial_cita_list' %}" class="btn-filter">Limpiar</a>
    </div>
  </form>
  <a href="{% url 'comercial_cita_create' %}?next={{ request.get_full_path|urlencode }}" class="btn-primary btn-primary-inline">Nueva cita</a>
{% endblock %}

{% block tabla_head %}
  <tr>
    <th>Acciones</th>
    <th>Prospecto</th>
    <th>Medio</th>
    <th>Servicio</th>
    <th>Vendedor</th>
    <th>Estatus cita</th>
    <th>Fecha cita</th>
    <th>NÃºmero cita</th>
    <th>Estatus seguimiento</th>
    <th>Lugar</th>
    <th>Propuesta</th>
  </tr>
{% endblock %}

{% block tabla_body %}
  {% for c in citas %}
    <tr>
      <td>
        <a href="{% url 'comercial_cita_update' c.id %}?next={{ request.get_full_path|urlencode }}" class="btn-detalle">Detalle</a>
      </td>
      <td >{{ c.prospecto|default_if_none:"" }}</td>
      <td>{{ c.medio|default_if_none:"" }}</td>
      <td>{{ c.servicio|default_if_none:"" }}</td>
      <td>{{ c.vendedor|default_if_none:"" }}</td>
      <td>{{ c.estatus_cita|default_if_none:"" }}</td>
      <td>{{ c.fecha_cita|date:"l d/M/y H:i"|default_if_none:"" }}</td>
      <td>{{ c.numero_cita|default_if_none:"" }}</td>
      <td>{{ c.estatus_seguimiento|default_if_none:"" }}</td>
      <td>{{ c.lugar|default_if_none:"" }}</td>
      <td>
        {% if c.propuesta %}
          <a href="{{ c.propuesta }}" target="_blank" rel="noopener">Link</a>
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="100%">Sin citas registradas</td>
    </tr>
  {% endfor %}
{% endblock %}


