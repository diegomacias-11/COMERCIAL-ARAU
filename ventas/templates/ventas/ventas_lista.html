{% extends "lista.html" %}
{% load ventas_extras %}

{% block title %}Ventas{% endblock %}

{% block filtros %}
  <div class="filter-title">{{ mes_nombre }} {{ anio }}</div>
  <form action="{% url 'ventas_lista' %}" method="get" class="filter-form-simple dispersiones-filter">
    <label for="mes">Mes</label>
    <select id="mes" name="mes">
      {% if meses_choices %}
        {% for m, nombre in meses_choices %}
          <option value="{{ m }}" {% if mes == m|stringformat:'i' %}selected{% endif %}>{{ nombre }}</option>
        {% endfor %}
      {% else %}
        {% for m in meses %}
          <option value="{{ m }}" {% if mes == m|stringformat:'i' %}selected{% endif %}>{{ m|stringformat:"02d" }}</option>
        {% endfor %}
      {% endif %}
    </select>
    <label for="anio">Año</label>
    <input type="number" id="anio" name="anio" value="{{ anio }}" min="2000" max="2100">
    <button type="submit" class="btn-filter">Filtrar</button>
  </form>
  <a href="{% url 'ventas_agregar' %}?mes={{ mes }}&anio={{ anio }}&next={{ request.get_full_path|urlencode }}" class="btn-primary">Nueva venta</a>
{% endblock %}

{% block tabla_head %}
  <tr>
    <th class="sticky-1 col-actions">Acciones</th>
    <th class="sticky-2 col-fecha">Fecha</th>
    <th class="sticky-3">Cliente</th>
    <th>Servicio</th>
    <th>Facturadora</th>
    <th>No. factura</th>
    <th>Monto venta</th>
    <th>Comisión (%)</th>
    <th>Monto comisión</th>
    <th>Estatus pago</th>
    <th>Comentarios</th>
  </tr>
{% endblock %}

{% block tabla_body %}
  {% for d in ventas %}
    <tr>
      <td class="sticky-1 col-actions"><a class="btn-detalle" href="{% url 'ventas_editar' d.id %}?mes={{ mes }}&anio={{ anio }}&next={{ request.get_full_path|urlencode }}">Editar</a></td>
      <td class="sticky-2 col-fecha">{{ d.fecha|date:"d/m/Y" }}</td>
      <td class="sticky-3">{{ d.cliente }}</td>
      <td>{{ d.servicio|default_if_none:"" }}</td>
      <td>{{ d.facturadora|default_if_none:"" }}</td>
      <td>{{ d.num_factura|default_if_none:"" }}</td>
      <td>{{ d.monto_venta|currency }}</td>
      <td>{{ d.comision_porcentaje|floatformat:2 }}%</td>
      <td>{{ d.monto_comision|currency }}</td>
      <td>{{ d.estatus_pago }}</td>
      <td>{{ d.comentarios|default_if_none:"" }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="11">Sin ventas en el periodo.</td></tr>
  {% endfor %}
{% endblock %}
